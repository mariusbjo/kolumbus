<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="UTF-8" />
  <title>Kollektivdata â€“ SystemverktÃ¸y v1.0</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="stylesheet" href="web/style.css" />
</head>

<body class="welcome-body">
  <div class="welcome-container">

    <div class="welcome-header">
      <h1>Kollektivdata â€“ SystemverktÃ¸y v1.0</h1>
      <button id="theme-toggle" class="theme-toggle">ðŸŒ“</button>
    </div>

    <p class="welcome-subtitle">Velg et verktÃ¸y for Ã¥ fortsette</p>

    <div class="card-grid">

      <!-- SANNTIDSKART -->
      <a class="tool-card" href="realtime.html">
        <div class="tool-icon">ðŸšŒ</div>
        <div class="tool-title">Sanntidskart</div>
        <div class="tool-desc">Live posisjoner fra Kolumbus, med fartslogging og detaljert ruteinformasjon</div>
        <div class="tool-status" id="status-realtime">Lasterâ€¦</div>
      </a>

      <!-- TESTKART -->
      <a class="tool-card" href="web/test_speedlimits.html">
        <div class="tool-icon">ðŸš§</div>
        <div class="tool-title">Fartsgrensekart â€“ Rogaland</div>
        <div class="tool-desc">Heatmap og segmentvisning av fartsgrensedata fra SVV</div>
        <div class="tool-status" id="status-speed">Lasterâ€¦</div>
      </a>

      <!-- DASHBOARD -->
      <a class="tool-card" href="dashboard/status.html">
        <div class="tool-icon">ðŸ“Š</div>
        <div class="tool-title">Systemstatus Dashboard</div>
        <div class="tool-desc">Oversikt over datastrÃ¸mmer til sanntidskart og fartsgrensekart</div>
        <div class="tool-status" id="status-dashboard">Lasterâ€¦</div>
      </a>

    </div>

    <div class="welcome-updated">
      Sist oppdatert: <span id="last-updated">Lasterâ€¦</span>
    </div>

  </div>

  <script>
    /* ---------------------------------------------------------
       THEME TOGGLE
    --------------------------------------------------------- */
    const html = document.documentElement;
    const toggle = document.getElementById("theme-toggle");

    const stored = localStorage.getItem("welcome-theme");
    if (stored) html.setAttribute("data-theme", stored);

    toggle.addEventListener("click", () => {
      const next = html.getAttribute("data-theme") === "dark" ? "light" : "dark";
      html.setAttribute("data-theme", next);
      localStorage.setItem("welcome-theme", next);
    });

    /* ---------------------------------------------------------
       LAST UPDATED
    --------------------------------------------------------- */
    async function loadLastUpdated() {
      try {
        const res = await fetch("meta/last_deploy.txt", { cache: "no-store" });
        const epoch = parseInt((await res.text()).trim(), 10);
        const date = new Date(epoch * 1000);
        document.getElementById("last-updated").textContent =
          date.toISOString().replace("T", " ").replace("Z", " UTC");
      } catch {
        document.getElementById("last-updated").textContent = "ukjent";
      }
    }
    loadLastUpdated();

    /* ---------------------------------------------------------
       STATUS INDICATORS
       Henter dashboard.json fra gh-pages
    --------------------------------------------------------- */
    async function loadStatus() {
      try {
        const res = await fetch("dashboard/dashboard.json", { cache: "no-store" });
        const data = await res.json();

        // Dashboard status
        document.getElementById("status-dashboard").textContent = "OK";
        document.getElementById("status-dashboard").classList.add("status-ok");

        // Speedlimits status (basert pÃ¥ hash)
        if (data.hash && data.hash.length > 0) {
          document.getElementById("status-speed").textContent = "OK";
          document.getElementById("status-speed").classList.add("status-ok");
        } else {
          document.getElementById("status-speed").textContent = "Feil";
          document.getElementById("status-speed").classList.add("status-err");
        }

        // Realtime status (dummy â€“ kan kobles til API senere)
        document.getElementById("status-realtime").textContent = "OK";
        document.getElementById("status-realtime").classList.add("status-ok");

      } catch {
        document.getElementById("status-dashboard").textContent = "Feil";
        document.getElementById("status-dashboard").classList.add("status-err");
      }
    }
    loadStatus();
  </script>
</body>
</html>
